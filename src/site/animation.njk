---
layout: layouts/_base.njk
---

<!-- prettier-ignore -->
{% macro circle(id) %}
<div id="{{ id }}" style="flex: auto; margin-right: 1rem">
  <svg xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 100 100">
    <circle
      cx="50"
      cy="50"
      r="48"
      stroke-width="2"
      stroke="black"
      fill="none"
    />
  </svg>
</div>
<!-- prettier-ignore -->
{% endmacro %}

<div
  style="
    position: relative;
    width: 50vw;
    height: 50vw;
    margin: 128px auto;
    border: 1px solid black;
  "
>
  <div
    style="
      position: absolute;
      bottom: 43%;
      left: 7%;
      width: 25%;
      height: 25%;
      border-left: 5px solid black;
      transform: rotate(-8deg);
    "
  >
    <canvas
      id="flag1"
      style="width: 100%; margin-top: -8%; margin-left: -2%"
    ></canvas>
    <div
      id="vote1"
      style="position: absolute; width: 160%; top: -29%; left: -33%"
    >
      <svg
        xmlns="http://www.w3.org/2000/svg"
        version="1.1"
        viewBox="0 0 100 100"
      >
        <circle
          cx="50"
          cy="50"
          r="48"
          stroke-width="2"
          stroke="black"
          fill="none"
        />
      </svg>
    </div>
  </div>
  <div
    style="
      position: absolute;
      bottom: 60%;
      left: 41%;
      width: 25%;
      height: 25%;
      border-left: 5px solid black;
      transform: rotate(-8deg);
    "
  >
    <canvas
      id="flag2"
      style="width: 100%; margin-top: -8%; margin-left: -2%"
    ></canvas>
    <div
      id="vote2"
      style="position: absolute; width: 160%; top: -29%; left: -33%"
    >
      <svg
        xmlns="http://www.w3.org/2000/svg"
        version="1.1"
        viewBox="0 0 100 100"
      >
        <circle
          cx="50"
          cy="50"
          r="48"
          stroke-width="2"
          stroke="black"
          fill="none"
        />
      </svg>
    </div>
    <div
      id="vote3"
      style="position: absolute; width: 180%; top: -39%; left: -43%"
    >
      <svg
        xmlns="http://www.w3.org/2000/svg"
        version="1.1"
        viewBox="0 0 100 100"
      >
        <circle
          cx="50"
          cy="50"
          r="48"
          stroke-width="2"
          stroke="black"
          fill="none"
        />
      </svg>
    </div>
  </div>
  <div
    style="
      position: absolute;
      bottom: 43%;
      left: 73%;
      width: 25%;
      height: 25%;
      border-left: 5px solid black;
      transform: rotate(-8deg);
    "
  >
    <canvas
      id="flag3"
      style="width: 100%; margin-top: -8%; margin-left: -2%"
    ></canvas>
  </div>
  <div
    style="
      position: absolute;
      bottom: 0;
      display: flex;
      width: 100%;
      padding-left: 1rem;
    "
  >
    <!-- prettier-ignore -->
    {% for i in range(0, 10) %}
    {{ circle("circle" + i) }}
    <!-- prettier-ignore -->
    {% endfor %}
  </div>
</div>

<script>
  // Inspired by https://codepad.co/snippet/html-canvas-flag-wave
  const Flag = function ($canvas) {
    this.$canvas = $canvas;
  };

  Flag.prototype.draw = function () {
    const width = this.$canvas.width;
    const height = width / 1.5;
    this.$canvas.height = height;

    // const c = (7 * height) / 13;
    // const d = 0.76 * height;
    // const e = 0.054 * height;
    // const g = 0.063 * height;
    // const k = 0.0616 * height;
    // const l = height / 13;

    const ctx = this.$canvas.getContext("2d");

    // Stripes
    ctx.fillStyle = "#118806";
    ctx.fillRect(5, 25, 300, 50);
    ctx.fillStyle = "#118806";
    ctx.fillRect(5, 75, 300, 50);
    ctx.fillStyle = "#118806";
    ctx.fillRect(5, 125, 300, 50);
  };

  Flag.prototype.wave = function (
    wavelength = this.$canvas.width / 10,
    amplitude = 10,
    period = 200,
    shading = 100,
    squeeze = 0
  ) {
    const fps = 30;
    const ctx = this.$canvas.getContext("2d");
    const w = this.$canvas.width;
    const h = this.$canvas.height;
    const od = ctx.getImageData(0, 0, w, h).data;
    return setInterval(function () {
      const id = ctx.getImageData(0, 0, w, h);
      const d = id.data;
      const now = new Date() / period;
      for (let y = 0; y < h; ++y) {
        let lastO = 0;
        let shade = 0;
        const sq = (y - h / 2) * squeeze;
        for (let x = 0; x < w; ++x) {
          const px = (y * w + x) * 4;
          const pct = x / w;
          const o = Math.sin(x / wavelength - now) * amplitude * pct;
          const y2 = (y + (o + sq * pct)) << 0;
          const opx = (y2 * w + x) * 4;
          shade = (o - lastO) * shading;
          d[px] = od[opx] + shade;
          d[px + 1] = od[opx + 1] + shade;
          d[px + 2] = od[opx + 2] + shade;
          d[px + 3] = od[opx + 3];
          lastO = o;
        }
      }
      ctx.putImageData(id, 0, 0);
    }, 1000 / fps);
  };

  const flag1 = new Flag(document.getElementById("flag1"));
  flag1.draw();
  flag1.wave(20, 10, 150, 200, -0.1);

  const flag2 = new Flag(document.getElementById("flag2"));
  flag2.draw();
  flag2.wave(20, 10, 150, 200, -0.1);

  const flag3 = new Flag(document.getElementById("flag3"));
  flag3.draw();
  flag3.wave(20, 10, 150, 200, -0.1);
</script>
